[supervisord]
nodaemon=true
logfile=/var/log/supervisor/supervisord.log
pidfile=/var/run/supervisord.pid

[program:postgresql]
command=/usr/lib/postgresql/14/bin/postgres -D /var/lib/postgresql/14/main -c config_file=/etc/postgresql/14/main/postgresql.conf
user=postgres
autorestart=true
stdout_logfile=/var/log/supervisor/postgresql.log
stderr_logfile=/var/log/supervisor/postgresql.log
priority=100

[program:redis]
command=/usr/bin/redis-server /etc/redis/redis.conf
user=redis
autorestart=true
stdout_logfile=/var/log/supervisor/redis.log
stderr_logfile=/var/log/supervisor/redis.log
priority=200

[program:ollama]
command=/usr/local/bin/ollama serve
environment=OLLAMA_HOST=%(ENV_OLLAMA_HOST)s,OLLAMA_MODELS=%(ENV_OLLAMA_MODELS)s,OLLAMA_KEEP_ALIVE=%(ENV_OLLAMA_KEEP_ALIVE)s,OLLAMA_MAX_LOADED_MODELS=%(ENV_OLLAMA_MAX_LOADED_MODELS)s
autorestart=true
stdout_logfile=/var/log/supervisor/ollama.log
stderr_logfile=/var/log/supervisor/ollama.log
priority=300

[program:ollama-manager]
command=npm start
directory=/app/ollama-manager
environment=PORT=3000,OLLAMA_URL=http://127.0.0.1:11434,NODE_ENV=%(ENV_NODE_ENV)s
autorestart=true
stdout_logfile=/var/log/supervisor/ollama-manager.log
stderr_logfile=/var/log/supervisor/ollama-manager.log
priority=400

[program:n8n]
command=n8n start
environment=N8N_HOST=%(ENV_N8N_HOST)s,N8N_PORT=%(ENV_N8N_PORT)s,N8N_BASIC_AUTH_ACTIVE=%(ENV_N8N_BASIC_AUTH_ACTIVE)s,N8N_BASIC_AUTH_USER=%(ENV_N8N_BASIC_AUTH_USER)s,N8N_BASIC_AUTH_PASSWORD=%(ENV_N8N_BASIC_AUTH_PASSWORD)s,DB_TYPE=%(ENV_N8N_DB_TYPE)s,DB_POSTGRESDB_HOST=127.0.0.1,DB_POSTGRESDB_PORT=5432,DB_POSTGRESDB_DATABASE=%(ENV_N8N_DB_NAME)s,DB_POSTGRESDB_USER=%(ENV_POSTGRES_USER)s,DB_POSTGRESDB_PASSWORD=%(ENV_POSTGRES_PASSWORD)s,N8N_ENCRYPTION_KEY=%(ENV_N8N_ENCRYPTION_KEY)s,N8N_USER_FOLDER=/app/n8n-data,GENERIC_TIMEZONE=%(ENV_TIMEZONE)s,WEBHOOK_URL=%(ENV_N8N_WEBHOOK_URL)s,N8N_PROTOCOL=%(ENV_N8N_PROTOCOL)s
autorestart=true
stdout_logfile=/var/log/supervisor/n8n.log
stderr_logfile=/var/log/supervisor/n8n.log
priority=500

[program:evolution-api]
command=npm start
directory=/app/evolution-api
environment=SERVER_TYPE=%(ENV_EVOLUTION_SERVER_TYPE)s,SERVER_PORT=8080,DEL_INSTANCE=%(ENV_EVOLUTION_DEL_INSTANCE)s,DATABASE_ENABLED=%(ENV_DATABASE_ENABLED)s,DATABASE_CONNECTION_URI=%(ENV_DATABASE_CONNECTION_URI)s,DATABASE_CONNECTION_DB_PREFIX_NAME=%(ENV_DATABASE_CONNECTION_DB_PREFIX_NAME)s,REDIS_ENABLED=%(ENV_REDIS_ENABLED)s,REDIS_URI=%(ENV_REDIS_URI)s,REDIS_PREFIX_KEY=%(ENV_REDIS_PREFIX_KEY)s,AUTHENTICATION_TYPE=%(ENV_EVOLUTION_AUTH_TYPE)s,AUTHENTICATION_API_KEY=%(ENV_EVOLUTION_API_KEY)s,AUTHENTICATION_EXPOSE_IN_FETCH_INSTANCES=%(ENV_EVOLUTION_EXPOSE_FETCH)s,LANGUAGE=%(ENV_EVOLUTION_LANGUAGE)s,LOG_LEVEL=%(ENV_LOG_LEVEL)s,LOG_COLOR=%(ENV_LOG_COLOR)s,LOG_BAILEYS=%(ENV_LOG_BAILEYS)s,CONFIG_SESSION_PHONE_CLIENT=%(ENV_CONFIG_SESSION_PHONE_CLIENT)s,CONFIG_SESSION_PHONE_NAME=%(ENV_CONFIG_SESSION_PHONE_NAME)s
autorestart=true
stdout_logfile=/var/log/supervisor/evolution.log
stderr_logfile=/var/log/supervisor/evolution.log
priority=600

[program:nginx]
command=/usr/sbin/nginx -g "daemon off;"
autorestart=true
stdout_logfile=/var/log/supervisor/nginx.log
stderr_logfile=/var/log/supervisor/nginx.log
priority=700